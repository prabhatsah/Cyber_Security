import { RenderAppBreadcrumb } from "@/components/app-breadcrumb";
import { Badge } from "@/components/Badge";
import { NetworkPentestProvider } from "./components/NetworkPentestContext";
import NetworkPentestWorkflow from "./components/NetworkPentestWorkflow";
import NetworkPentestProgressBar from "./components/NetworkPentestProgressBar";
import ScanLogsPanel from "./components/ScanLogsPanel";


export default async function RootLayout({
    children,
    params
}: {
    children: React.ReactNode;
    params: Promise<{ pentestIdName: string }>;
}) {
    const pentestIdName = (await params).pentestIdName;
    const [pentestId, pentestName] = decodeURIComponent(pentestIdName).split("_");

    return (
        <>
            <RenderAppBreadcrumb
                breadcrumb={{
                    level: 0,
                    title: "Penetration Testing",
                    href: "/pen-test",
                }}
            />
            <RenderAppBreadcrumb
                breadcrumb={{
                    level: 1,
                    title: "Network Penetration Testing",
                    href: "/pen-test/network-pen-test",
                }}
            />
            <RenderAppBreadcrumb
                breadcrumb={{
                    level: 2,
                    title: pentestName,
                }}
            />

            <NetworkPentestProvider>
                <div className="flex flex-col gap-6 overflow-hidden h-full w-full p-0 ">
                    <div className="flex flex-col justify-between gap-2">
                        <Badge className="text-widgetHeader p-2 text-xl flex items-center justify-between">
                            <span>{pentestName}</span>
                            <NetworkPentestProgressBar pentestIdName={pentestIdName} />
                        </Badge>
                        <div className="flex flex-col overflow-hidden">
                            <NetworkPentestWorkflow pentestIdName={pentestIdName} />
                        </div>
                    </div>

                    {/* <div className="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-3 overflow-y-auto">
                        <div className="overflow-y-auto lg:col-span-2" id="all-tabs-content">{children}</div>
                        <div className="lg:col-span-1">
                            <ScanLogsPanel />
                        </div>
                    </div> */}

                    <div className="flex-1 flex overflow-y-auto gap-6" id="networkPentestTabContent">
                        <div className="flex-1 overflow-y-auto" id="all-tabs-content">{children}</div>
                        <div className="" id="scanLogsDiv">
                            <ScanLogsPanel />
                        </div>
                    </div>
                </div>
            </NetworkPentestProvider>
        </>
    );
}
