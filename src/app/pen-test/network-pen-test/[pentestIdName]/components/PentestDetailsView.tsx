"use client";

import { Drawer, DrawerBody, DrawerClose, DrawerContent, DrawerDescription, DrawerFooter, DrawerHeader, DrawerTitle, DrawerTrigger } from "@/components/Drawer";
import { Button } from "@/components/Button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { useNetworkPentestContext } from "./NetworkPentestContext";
import { Badge } from "@/components/Badge";
import React from "react";

function KV({
    value,
    label,
}: {
    value: React.ReactNode
    label: string
}) {
    return (
        <div className="relative">
            <div className="text-sm font-semibold text-foreground">{value ?? "N/A"}</div>
            <div className="text-xs text-muted-foreground">{label}</div>
        </div>
    )
}

export default function PentestDetailsView({ pentestName }: { pentestName: string }) {
    const { pentestData } = useNetworkPentestContext();

    return (
        <div className="flex items-center justify-between px-2">
            <h2>{pentestName}</h2>
            <Drawer>
                <DrawerTrigger asChild>
                    <Button variant="secondary">Open Pentest data</Button>
                </DrawerTrigger>
                <DrawerContent className="sm:max-w-lg">
                    <DrawerHeader>
                        <DrawerTitle>Account Created Successfully</DrawerTitle>
                        <DrawerDescription className="mt-1 text-sm">
                            Your account has been created successfully. You can now login to
                            your account. For more information, please contact us.
                        </DrawerDescription>
                    </DrawerHeader>
                    <DrawerBody>
                        <Card className="border  shadow-md">
                            <CardHeader>
                                <CardTitle className="text-lg">Pentest Object Overview</CardTitle>
                                <CardDescription>All relevant fields from the provided pentest object</CardDescription>
                            </CardHeader>
                            <CardContent>
                                <div className="rounded-md  p-4 border ">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
                                        <KV value={pentestData?.pentest_id || "KER-NETP-250925001"} label="Pentest ID" />
                                        <KV
                                            value={pentestData?.pentest_name || "Demo Network Penetration Test N1 - 2025"}
                                            label="Pentest Name"
                                        />
                                        <KV value={pentestData?.client_name || "S2 Cyber Security"} label="Client" />
                                        <KV
                                            value={pentestData?.pentest_description || "Demo Network Penetration Test N1 - 2025"}
                                            label="Description"
                                        />
                                        <KV
                                            value={
                                                <Badge variant="secondary" className="px-2 py-0.5 text-xs">
                                                    {pentestData?.aggressiveness || "Normal"}
                                                </Badge>
                                            }
                                            label="Aggressiveness"
                                        />
                                        <KV
                                            value={typeof pentestData?.progress === "number" ? `${pentestData.progress}%` : "10%"}
                                            label="Progress"
                                        />
                                        <KV value={pentestData?.scope_type || "CIDR Network Range"} label="Scope Type" />
                                        <KV value={pentestData?.cidr_range || "192.168.3.0/24"} label="CIDR Range" />
                                        <KV value={pentestData?.hostname || "N/A"} label="Hostname" />
                                        <KV value={(pentestData?.ip_addresses || []).join(", ") || "N/A"} label="IP Addresses" />
                                        <KV value={pentestData?.start_ip || "N/A"} label="Start IP" />
                                        <KV value={pentestData?.end_ip || "N/A"} label="End IP" />
                                        <KV value={pentestData?.agent_ip || "192.168.3.35"} label="Agent IP" />
                                        <KV value={pentestData?.subnet_mask || "192.168.3.250"} label="Subnet Mask" />
                                        <KV value={pentestData?.default_gateway || "192.168.3.250"} label="Default Gateway" />
                                        <KV value={pentestData?.probe_id || "fae9d00f-bc18-4017-901a-109eddc35cf1"} label="Agent ID" />
                                        <KV value={pentestData?.probe_name || "Cyber Security - Sayan"} label="Agent Name" />
                                        <KV value={pentestData?.probe_machine_hostname || "KERLPTP-47"} label="Machine Hostname" />
                                        <KV value={pentestData?.probe_machine_ip_address || "169.254.88.177"} label="Machine IP" />
                                        <KV value={pentestData?.probe_machine_os || "Windows"} label="OS" />
                                        <KV
                                            value={pentestData?.created_by_id || "be7a0ece-f3d8-4c5b-84dc-52c32c4adff4"}
                                            label="Created By ID"
                                        />
                                        <KV value={pentestData?.created_by_login || "K2211089"} label="Created By Login" />
                                        <KV
                                            value={
                                                pentestData?.created_on
                                                    ? new Date(pentestData.created_on).toLocaleString()
                                                    : "2025-09-25T10:43:43.597Z"
                                            }
                                            label="Created On"
                                        />
                                    </div>
                                </div>
                            </CardContent>
                        </Card>
                    </DrawerBody>
                    <DrawerFooter className="mt-6">
                        <DrawerClose asChild>
                            <Button
                                className="mt-2 w-full sm:mt-0 sm:w-fit"
                                variant="secondary"
                            >
                                Go back
                            </Button>
                        </DrawerClose>
                        <DrawerClose asChild>
                            <Button className="w-full sm:w-fit">Ok, got it!</Button>
                        </DrawerClose>
                    </DrawerFooter>
                </DrawerContent>
            </Drawer>
        </div>
    )
}
