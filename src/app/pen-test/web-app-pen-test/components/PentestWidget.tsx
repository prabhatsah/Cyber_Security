'use client';

import { Callout } from '@/components/Callout';
import { RiCalendarScheduleLine, RiCrosshairLine, RiFolderOpenLine, RiInformationLine, RiMoneyCnyBoxFill, RiTimeZoneFill, RiTimeZoneLine, RiUserLine } from '@remixicon/react';
import {
    Card,
    Divider,
    ProgressCircle,
} from '@tremor/react';
import { PenTestModified } from './type';
import { format, formatDistanceToNowStrict } from 'date-fns';
import Link from 'next/link';
import { Button } from '@/components/Button';
import PriorityBadge from './PriorityBadge';
import StatusBadge from './StatusBadge';
import ActionButton from './ActionButton';



function classNames(...classes: string[]) {
    return classes.filter(Boolean).join(' ');
}


export default function PentestWidget({ allPentestWidgetData }: { allPentestWidgetData: PenTestModified[]; }) {
    return (
        <>



            <div className="space-y-4 mb-4">
                <div className="overflow-x-auto">
                    <div className="shadow rounded-lg border">
                        <div className="px-6 py-4 border-b">
                            <h2 className="text-lg font-medium text-widgetHeader">Active Tests</h2>
                        </div>
                        <table className="min-w-full divide-y divide">
                            <thead className="">
                                <tr>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Targets
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Type
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Methodology
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Priority
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Start Date
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Progress
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Status
                                    </th>
                                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-widget-mainHeader uppercase tracking-wider">
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody className=" divide-y divide">
                                {allPentestWidgetData.map((pentest) => {
                                    const pentestNameInUrl = pentest.basicDetails.pentestName.toLowerCase().replace(/\s+/g, '-');
                                    const status = pentest.aiAnalysis ? "Completed" : (pentest.reconnaissance ? "In Progress" : "Pending");

                                    return (
                                        <tr key={pentest.pentestId} className="">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="flex items-center">
                                                    <div className="text-sm font-medium text-widget-mainDesc">
                                                        {pentest.basicDetails.webApp}
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm text-widget-mainDesc">{pentest.basicDetails.scope}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm text-widget-mainDesc">{pentest.basicDetails.testingType}</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <PriorityBadge level={pentest.basicDetails.priorityLevel} />
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="text-sm text-widget-mainDesc">
                                                    {format(pentest.basicDetails.startDate, "yyyy-MM-dd HH:mm")}
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap flex items-center gap-4">
                                                <div className="w-full bg-gray-200 rounded-full h-2.5">
                                                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: '0%' }}></div>
                                                </div>
                                                <div className="text-xs text-widget-mainDesc mt-1">0%</div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <StatusBadge status={status} />
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                <div className="flex space-x-2">
                                                    <ActionButton
                                                        href={`/pen-test/web-app-pen-test/${pentest.basicDetails.pentestId}_${pentestNameInUrl}`}
                                                        title={`Open ${pentest.basicDetails.pentestName}`}
                                                    />
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </>
    );
}