import {
    Table,
    TableBody,
    TableCell,
    TableHead,
    TableHeaderCell,
    TableRoot,
    TableRow,
} from "@/components/Table";
import React from "react";
import { Bar, BarChart, Tooltip, XAxis, YAxis } from "recharts";

interface Domain {
    fqdn: string;
    ipAddress: string;
    category: string;
    notes?: string;
}

interface SubdomainReportProps {
    domains: Domain[];
    domainDescription?: string;
}

export default function SubdomainReport({ domains, domainDescription = '' }: SubdomainReportProps) {
    // Calculate category frequencies
    const freq: Record<string, number> = {};
    console.log("From Subdomain")
    domains.forEach(domain => {
        const cat = domain.category || '-';
        freq[cat] = (freq[cat] || 0) + 1;
    });

    // Transform frequencies into chart data
    interface NameValue { name: string; value: number; }
    const chartData: NameValue[] = Object.entries(freq).map(
        ([name, value]) => ({ name, value })
    );

    return (
        <div className="flex-1 overflow-y-auto">
            <p className="text-lg">Domain & Subdomain Landscape</p>
            {domainDescription && <p>{domainDescription}</p>}

            <div className="flex">
                <div className="lg:w-[80%] w-full max-h-64 overflow-y-auto">
                    <TableRoot>
                        <Table>
                            <TableHead>
                                <TableRow>
                                    <TableHeaderCell>FQDN</TableHeaderCell>
                                    <TableHeaderCell>IP Address</TableHeaderCell>
                                    <TableHeaderCell>Category</TableHeaderCell>
                                    <TableHeaderCell>Notes / Hosting ASN Hint</TableHeaderCell>
                                </TableRow>
                            </TableHead>

                            <TableBody>
                                {domains.map(({ fqdn, ipAddress, category, notes }, idx) => (
                                    <TableRow key={fqdn || idx}>
                                        <TableCell>{fqdn}</TableCell>
                                        <TableCell>{ipAddress || "-"}</TableCell>
                                        <TableCell>{category || "-"}</TableCell>
                                        <TableCell>{notes || "-"}</TableCell>
                                    </TableRow>
                                ))}
                            </TableBody>
                        </Table>
                    </TableRoot>
                </div>
{/* margin={{ top: 10, right: 30, bottom: 5, left: 0 }} */}
                <div className="lg:w-[20%] w-full relative">
                    <BarChart data={chartData} >
                        <XAxis dataKey="name" />
                        <YAxis />
                        <Tooltip />
                        <Bar dataKey="value" />
                    </BarChart>
                </div>
            </div>
        </div>
    );
}
