"use client";

import { useEffect } from 'react';
import io from 'socket.io-client';

const ScanStatus = () => {
  useEffect(() => {
    const socket = io('https://ikoncloud-uat.keross.com', {
      path: '/cstools/socket.io',
      transports: ['websocket'],
    });

    socket.on('scan_complete', (data) => {
      console.log('Scan completed:', data);
    });

    return () => {
      socket.disconnect();
    };
  }, []);

  async function handleClick() {
    console.log("handleClick called");

    const payload = {
      user_id: '38384a69-e2aa-42ad-bc67-47502d563148',
      tool: 'whatweb',
      target: 'keross.com',
      pentestid: '8aece9dc-b1f1-422d-bac8-39d02d425cdf',
    };

    const res = await fetch('/api/start-scan', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    if (!res.ok) {
      throw new Error(`Server error: ${res.status}`);
    }

    const data = await res.json();

    console.log("---------------");
    console.log(data);
  }


  return (
    <div>
      <h1>Scan Status</h1>
      <button onClick={handleClick}>Start Scan</button>
    </div>
  );
};

export default ScanStatus;

// "use client";

// import { useState, useEffect } from 'react';
// import io from 'socket.io-client';

// const ScanStatus = () => {
//   const [status, setStatus] = useState('Waiting for scan...');

//   useEffect(() => {
//     const socket = io('https://ikoncloud-uat.keross.com', {
//       path: '/cstools/socket.io',
//       transports: ['websocket'],
//     });

//     socket.on('connect', () => {
//       console.log('Socket connected');
//     });

//     socket.on('scan_complete', (data) => {
//       console.log('Scan completed:', data);
//       setStatus(`Scan completed: ${data.message || 'Success'}`);
//     });

//     socket.on('connect_error', (err) => {
//       console.error('Socket connection error:', err);
//       setStatus('Connection error');
//     });

//     return () => {
//       socket.disconnect();
//     };
//   }, []);

//   return (
//     <div>
//       <h1>Scan Status</h1>
//       <p>{status}</p>
//     </div>
//   );
// };

// export default ScanStatus;
