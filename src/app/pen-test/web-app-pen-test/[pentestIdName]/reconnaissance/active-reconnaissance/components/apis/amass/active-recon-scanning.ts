import { useEffect, useState } from "react";
import { initiateAmassScan } from "./initiateAmassScan";
import { checkAmassStatus } from "./checkAmassStatus";
import { fetchAmassResult } from "./fetchAmassResult";
import { updatePentestData } from "@/app/pen-test/components/apis/configurePentestDataHandler";
import StartScan from "@/utils/generic-start-scan";
import { getLoggedInUserProfile } from "@/ikon/utils/api/loginService";
import useInitiateWebSocket from "@/utils/web-socket";
import { io } from "socket.io-client";

export const activeReconScanning = (webApp: string, pentestId: string) => {
  const [isScanning, setIsScanning] = useState(false);

  const initiateScan = async () => {
    const userId = (await getLoggedInUserProfile()).USER_ID;

    setIsScanning(true);

    try {
      // const result = await initiateAmassScan(webApp);
      // useInitiateWebSocket();
      const nmapResult = await StartScan(userId, "nmap", webApp, pentestId);
      console.log("Scan Details: ", nmapResult);

      const whatWebResult = await StartScan(
        userId,
        "whatweb",
        webApp,
        pentestId
      );
      console.log("Scan Details: ", whatWebResult);

      const result = [nmapResult, whatWebResult];
      setIsScanning(false);
      return result;
    } catch (err) {
      console.error("Error starting scan:", err);
      setIsScanning(false);
    }
  };

  return { initiateScan, isScanning };
};
