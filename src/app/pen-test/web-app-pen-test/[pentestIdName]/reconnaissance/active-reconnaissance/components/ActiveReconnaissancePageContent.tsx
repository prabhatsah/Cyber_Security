"use client";

import { redirect } from "next/navigation";
import { useEffect, useState } from "react";
import { usePentestContext } from "../../../components/PentestContext";
import GlobalLoader from "@/components/GlobalLoader";
import NoReconnaissanceDataTemplate from "./NoReconnaissanceDataTemplate";

export default function ActiveReconnaissancePageContent({ pentestIdName }: { pentestIdName: string }) {
    const [pentestId, pentestName] = pentestIdName.split("_");
    const { pentestData, loading, error, setPentestId } = usePentestContext();
    const [redirecting, setRedirecting] = useState(false);

    useEffect(() => {
        if (typeof pentestId === 'string') {
            setPentestId(pentestId);
        }
    }, [pentestId]);

    useEffect(() => {
        if (pentestData?.reconnaissance !== null) {

            setRedirecting(true);

            const timeout = setTimeout(() => {
                redirect(`/pen-test/web-app-pen-test/${pentestIdName}/reconnaissance/active-reconnaissance/overview`);
            }, 100);
            return () => clearTimeout(timeout);
        }
    }, [pentestData, pentestIdName]);

    if (error) return <div>{error}</div>;
    if (!pentestData && !loading) return <div></div>;
    if (loading || !pentestData || redirecting) return <GlobalLoader />;

    const webApp: string = pentestData.basicDetails.webApp;
    // const pentestSubPartData: any = pentestData.reconnaissance === null ? null : { ...pentestData.reconnaissance };

    return (
        <>
            {/* {pentestSubPartData && (pentestSubPartData != null || pentestSubPartData != undefined) ?
                redirect(`/pen-test/web-app-pen-test/${pentestIdName}/reconnaissance/active-reconnaissance/overview`) :
                <NoReconnaissanceDataTemplate webApp={webApp} pentestId={pentestId} />
            } */}
            <NoReconnaissanceDataTemplate webApp={webApp} pentestId={pentestId} />
        </>
    );
}