"use client";

import { useEffect } from "react";
import { usePentestContext } from "../../../components/PentestContext";
import GlobalLoader from "@/components/GlobalLoader";
import ActiveReconnaissanceSidebar from "./ActiveReconnaissanceSidebar";

export default function ActiveReconnaissanceLayout({ pentestIdName }: { pentestIdName: string; }) {
    const [pentestId, pentestName] = pentestIdName.split("_");
    const { pentestData, loading, error, setPentestId } = usePentestContext();

    useEffect(() => {
        if (typeof pentestId === 'string') {
            setPentestId(pentestId);
        }
    }, [pentestId]);

    if (error) return <div>{error}</div>;
    if (!pentestData && !loading) return <div></div>;
    if (loading || !pentestData) return <GlobalLoader />;

    return (
        <>
            {pentestData && (pentestData.scanData.nmap || pentestData.scanData.whatweb || pentestData.scanData.amass) ?
                <div className="w-56 border-r border-gray-200 dark:border-gray-800">
                    <ActiveReconnaissanceSidebar pentestIdName={pentestIdName} />
                </div> : ""
            }
        </>
    )
}